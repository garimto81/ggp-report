# 보고서 자동 스케줄 가이드 (v1.3.0)

이 시스템은 GitHub Actions를 통해 자동으로 실행되도록 설계되었습니다.

## 현재 스케줄 (한국시간 기준)

- **일일 보고서**: 평일(화-금) 오전 10시 KST
- **주간 보고서**: 매주 월요일 오전 10시 10분 KST (첫번째 월요일 제외)
- **Monthly-Weekly 보고서**: 매주 월요일 오전 10시 KST (첫번째 월요일 제외) ✨ **NEW**
- **월간 보고서**: 매월 첫번째 월요일 오전 10시 KST

## 스케줄 우선순위

보고서 발송 규칙 (v1.3.0 업데이트):

1. **첫번째 월요일**: 월간 보고서만 발송 (10:00 AM)
2. **나머지 월요일**: 
   - 10:00 AM: Monthly-Weekly 보고서 (주간 데이터를 월간 스타일로 분석)
   - 10:10 AM: 기존 주간 보고서 (주간 스타일 분석)
3. **화요일-금요일**: 일일 보고서 발송 (10:00 AM)
4. **주말**: 보고서 없음

### 10분 간격 실행 이유
- **Monthly-Weekly**: 더 심층적인 월간 스타일 분석 제공
- **Weekly**: 기존 주간 분석 유지
- **10분 간격**: 두 보고서가 서로 다른 관점으로 같은 데이터 분석

### 예시 (2025년 8월):
- 8월 4일 (월) - 첫번째 월요일: **월간 보고서** (10:00 AM)
- 8월 5일 (화): **일일 보고서** (10:00 AM)
- 8월 6일 (수): **일일 보고서** (10:00 AM)
- 8월 7일 (목): **일일 보고서** (10:00 AM)
- 8월 8일 (금): **일일 보고서** (10:00 AM)
- 8월 9일 (토): 보고서 없음
- 8월 10일 (일): 보고서 없음
- 8월 11일 (월) - 두번째 월요일: 
  - 10:00 AM: **Monthly-Weekly 보고서**
  - 10:10 AM: **주간 보고서**

## GitHub Actions Cron 설정 (v1.3.0)

워크플로우별 스케줄:

### 일일 보고서 (`.github/workflows/daily-report.yml`)
```yaml
schedule:
  - cron: '0 1 * * 2-5'  # 화-금 10:00 AM KST
```

### 주간 보고서 (`.github/workflows/weekly-report.yml`)
```yaml
schedule:
  - cron: '10 1 * * 1'   # 월요일 10:10 AM KST (첫째 주 제외)
```

### Monthly-Weekly 보고서 (`.github/workflows/monthly-weekly-report.yml`)
```yaml
schedule:
  - cron: '0 1 * * 1'    # 월요일 10:00 AM KST (첫째 주 제외)
```

### 월간 보고서 (`.github/workflows/monthly-report.yml`)
```yaml
schedule:
  - cron: '0 1 1-7 * 1'  # 첫째 주 월요일만 (조건부 체크 포함)
```

### Cron 표현식 가이드
```
분 시 일 월 요일
0  1  *  *  1-5  # 평일 UTC 01:00 (한국시간 10:00)
0  1  *  *  1    # 월요일 UTC 01:00
0  1  *  *  2-5  # 화-금 UTC 01:00
```

### 시간대 변환
- 한국시간(KST) = UTC + 9시간
- 한국시간 오전 10시 = UTC 오전 1시
- 한국시간 오후 6시 = UTC 오전 9시

## 수동 실행

GitHub Actions 페이지에서 언제든지 수동으로 실행 가능:
1. https://github.com/garimto81/slack-report-automation/actions
2. 원하는 워크플로우 선택:
   - "Daily Report" - 일일 보고서
   - "Weekly Report" - 주간 보고서  
   - "Monthly-Weekly Report" - 월간 스타일 주간 보고서
   - "Monthly Report" - 월간 보고서
   - "Debug Report Issue" - 디버깅용
3. "Run workflow" 클릭
4. 필요시 보고서 타입 선택
5. "Run workflow" 실행

## 보고서 내용

### 분석 방식
- **AI 기반 문맥 분석**: Gemini AI가 메시지와 쓰레드를 종합 분석
- **키워드 기반 아님**: 카메라 파트 관련 업무인지 AI가 추론하여 판단
- **6하 원칙 적용**: who, what, when, where, why, how 기준으로 업무 정리

### 우선순위 정렬
모든 보고서는 카메라 파트 업무만 필터링하여 우선순위별로 정렬:
- 1순위: 긴급 장비 고장/클라이언트 촬영
- 2순위: 예정된 촬영 업무
- 3순위: 장비 관리 및 점검
- 4순위: 영상 편집/후반 작업
- 5순위: 일반 행정 업무

### 보고서 타입별 차이점
- **Daily**: 24시간 데이터, 일일 활동 중심 분석
- **Weekly**: 7일 데이터, 주간 인사이트 및 의사결정 중심
- **Monthly-Weekly**: 7일 데이터를 월간 스타일로 심층 분석
- **Monthly**: 한 달 데이터, 종합적 트렌드 및 영향력 분석

## 발송 대상

모든 보고서는 Slack DM으로 발송:
- **사용자 ID**: 환경변수 `SLACK_DM_USER_IDS`에 설정된 모든 사용자들 (쉼표로 구분)
- **예시**: `U080BA70DC4,U1234567890,U9876543210`
- **다중 전송**: 각 사용자에게 개별적으로 동일한 보고서 전송
- **히스토리**: Supabase에 모든 수신자 정보와 함께 저장

## 문제 해결 (v1.3.0)

### 월간 보고서가 매일 실행되는 문제 (해결됨)
- **원인**: 잘못된 cron 표현식 `0 1 1-7 * 1`
- **해결**: 첫째 주 월요일 체크 로직 추가
- **결과**: 이제 매월 첫째 주 월요일에만 정확히 실행

### "no work to report" 문제
- **원인**: 메시지는 수집되지만 카메라 관련 업무 없음
- **해결**: `debug-report.yml` 워크플로우로 진단 가능
- **분석**: AI가 문맥상 카메라 파트와 무관하다고 판단한 경우

### 디버깅 도구
- **워크플로우**: "Debug Report Issue" 수동 실행
- **로그**: 메시지 수집부터 AI 분석까지 전 과정 추적
- **웹사이트**: [프로젝트 소개 페이지](https://garimto81.github.io/slack-report-automation/)에서 시각적 설명